#!/usr/bin/env bash
# --------------------------------------------------------------------------------------------------
# sshgen
# A script to help with generating SSH keys quickly
# --------------------------------------------------------------------------------------------------

set -e

# ----- Key Generation -----------------------------------------------------------------------------

PS3="> "
KEYTYPE=
KEYCOMMENT=
KEYFILE=

main() {
    echo "Which key type would you like to generate?"
    select KEYTYPE in "ed25519" "ed25519-sk" "rsa" "dsa" "ecdsa" "ecdsa-sk"; do
        break
    done

    echo "Would you like to add a comment to this key?"
    select action in "Yes" "No" "Use git email"; do
        case $action in
            "Yes" ) read -e -p "Enter your comment: " KEYCOMMENT; break;;
            "No" ) KEYCOMMENT=""; break;;
            "Use git email" ) KEYCOMMENT=$(git config user.email); break;;
        esac
    done

    KEYFILE="${HOME}/.ssh/id_${KEYTYPE}"

    echo "Generating SSH key"
    echo "    File: $KEYFILE"
    echo "    Type: $KEYTYPE"
    echo "    Comment: $KEYCOMMENT"
    ssh-keygen -t $KEYTYPE -C $KEYCOMMENT -f $KEYFILE

    echo "Adding the key to ssh-agent"
    eval $(ssh-agent -s)
    ssh-add $KEYFILE

    echo "Add GitHub to ssh configuration?"
    select action in "Yes" "No"; do
        case $action in
            "Yes" ) echo "Host github.com\n    User git\n    Hostname github.com\n    IdentityFile $key_file" > ~/.ssh/config; break;;
            "No" ) break;;
        esac
    done

    echo
    echo "Your SSH key has been generated"
    echo "Private Key: $KEYFILE"
    echo "Public key: $KEYFILE.pub"
    echo "For GitHub: Add your public key to your account: https://github.com/settings/keys"
    echo "To update repo URLs, use: git remote set-url origin git@github.com:USERNAME/REPOSITORY.git"
}

main "$@"
