#!/usr/bin/env bash
set -euo pipefail

GIT_COLOR="#f14e32"

in_git_repository() {
    git rev-parse --git-dir > /dev/null 2>&1
}

git_color_text() {
    gum style --foreground "$GIT_COLOR" "$1"
}

get_branches() {
    local branches=()
    while IFS= read -r branch; do
        branches+=("$branch")
    done < <(git branch --format="%(refname:short)")
    
    gum choose "${branches[@]}" \
        --no-limit \
        --cursor.foreground="$GIT_COLOR" \
        --selected.foreground="$GIT_COLOR"
}

main() {
    if ! in_git_repository; then
        echo "$(git_color_text "!!") Must be run in a $(git_color_text "git") repo" 
        exit 1
    fi
    
    echo "Choose $(git_color_text ' branches') to delete:"

    local branches_to_delete=()
    while IFS= read -r branch; do
        branches_to_delete+=("$branch")
    done < <(get_branches)

    if [[ ${#branches_to_delete[@]} -eq 0 ]]; then
        echo "No branches were selected"
        exit 0
    fi

    git branch -D "${branches_to_delete[@]}"
}

main "$@"
